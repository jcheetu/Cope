(function(a){a.fn.chat=function(d){var g;var x=a.extend({baseUrl:"",accessToken:"",chatbotTitle:"",initialMessage:""},d);var o='<div class="main-chat-container empty" ><a href="#0" class="chat-button" style="z-index: 999;position: fixed;"></a><div class="chat-box" style="z-index: 999"><div class="chat-window"><header style="box-shadow: 0 -2px 20px rgba(0, 0, 0, 0.15);background: #e69c52;"> <div style="color: #fff;font-size: 17px;line-height: 1.1em;white-space: nowrap;text-align: center;margin: 9.5px auto;overflow: hidden;text-overflow: ellipsis;">'+x.chatbotTitle+'</div> </header><div class="body container"><copebot></copebot></div><footer><input  type="text" id="chat-input" autocomplete="off" placeholder="Send message" class="bot-form-control bot-txt"/></footer></div></div></div>';a(this).html(o);var n='<div class="chat-div" id="chat-div"><!--chat-div end-->';n+='<div id="response-container" class="resultDiv"></div><div class="loader-div" id="chat-div"><div class="loader"><div class="dot1"></div><div class="dot2"></div><div class="dot1"></div></div></div></div>';a("copebot").html(n);var y=a(".main-chat-container");if(y.length>0){var p=y.find(".body");var u=p.find("ul").eq(0);var s=y.find(".checkout").find("span");var e=y.children(".chat-button");t(a(this));e.on("click",function(A){a("#response-container").empty();c()})}function t(A){var B=y.hasClass("empty");y.removeClass("empty")}function c(A){var B=(typeof A==="undefined")?y.hasClass("chat-open"):A;if(B){y.removeClass("chat-open");a("#chatbot_frame").height("65px");a(".chat-box").hide()}else{a("#chatbot_frame").height("500px");a(".chat-box").css("margin-bottom","70px").fadeIn("slow");y.addClass("chat-open");m=b(true);k(x.initialMessage)}}var b=function(F){if(sessionStorage.getItem("session")&&F!=true){var H=sessionStorage.getItem("session")}else{var G=Math.floor((Math.random()*1000)+1);var E=Date.now();var B=new Date();var D=new Array(7);D[0]="Sunday";D[1]="Monday";D[2]="Tuesday";D[3]="Wednesday";D[4]="Thursday";D[5]="Friday";D[6]="Saturday";var A=D[B.getDay()];var C=G+A+E;sessionStorage.setItem("session",C);var H=sessionStorage.getItem("session")}return H};var m=b();a("#chat-input").on("keyup",function(B){var A=B.keyCode||B.which;var C=a("#chat-input").val();if(A===13){if(C==""||a.trim(C)==""){B.preventDefault();return false}else{z(C);k(C);B.preventDefault();return false}a("#chat-input").focus()}});function k(B){var A={text:B,sessionId:m,accessToken:x.accessToken,ai:x.ai};a.ajax({type:"POST",url:"/AI/sendrequest",data:JSON.stringify(A),contentType:"application/json; charset=utf-8",dataType:"json",headers:{Authorization:"Bearer "+x.accessToken},success:function(C){a("#chat-input").prop("disabled",false);h(C)},error:function(C){}})}function h(E){var D=E.result.action;var A=E.result.fulfillment.data;var G=E.result.fulfillment.messages;var B=E.result.actionIncomplete;if(B){w(E.result.fulfillment.speech)}else{if(G){var F=500;for(var C=0;C<G.length;C++){if(G[C].platform=="facebook"){if(G[C].speech){w(G[C].speech,F)}else{if(G[C].title){v(G[C],F)}else{if(G[C].imageUrl){r(G[C].imageUrl,F)}}}F+=F}else{if(G[C].platform!="facebook"&&G[C].platform!="skype"&&D!="send_mail"){w(E.result.fulfillment.speech)}}}if(D=="verify_user_demo"&&G.length==0&&A.fb.title!=undefined){k(A.fb.title)}}}}function w(B,A){setTimeout(function(){f();if(a.trim(B)==""){B="I couldn't get that. Let' try something else!";var C='<p class="response-text">'+B+'</p><div class="clearfix"></div>';a(C).appendTo("#response-container")}else{B=B.replace(new RegExp("\r?\n","g"),"<br />");var C='<p class="response-text">'+B+'</p><div class="clearfix"></div>';a(C).appendTo("#response-container")}j();l()},A);a("#chat-input").attr("readonly",false)}function r(A,B){setTimeout(function(){f();a('<p class="response-text"><img src='+A+' width = 50 height = 50></p><div class="clearfix"></div>').appendTo("#response-container");j();l()},B)}function z(B){var A='<p class="userEnteredText">'+B+'</p><div class="clearfix"></div>';a(A).appendTo("#response-container");a("#chat-input").val("");j();f()}function j(){var A=document.getElementById("chat-div");A.scrollTop=A.scrollHeight}function f(){a(".loader").show()}function l(){a(".loader").hide()}function v(B,A){setTimeout(function(){f();A=Math.ceil(Math.random()*10000000);var E=B.title;var D=B.replies;var C=B.replies.length;a('<p class="responseOption response-opt_'+A+'"></p><div class="clearfix"></div>').appendTo("#response-container");a('<div class="option-title">'+E+"</div>").appendTo(".response-opt_"+A);for(var i=0;i<C;i++){a('<span class="option-val">'+D[i]+"</span>").appendTo(".response-opt_"+A)}j();a("#chat-input").prop("disabled",true);l()},A);a("#chat-input").attr("readonly",true)}a(document).on("click",".responseOption span",function(){var A=this.innerText;z(A);k(A)});function q(C){var A=document.getElementById("chat-input");var D=A.value;var B=C.keyCode||C.which;if(B===13){if(D==""||a.trim(D)==""){C.preventDefault();return false}else{z(D);k(D);C.preventDefault();return false}a("#chat-input").focus()}}}}(jQuery));
